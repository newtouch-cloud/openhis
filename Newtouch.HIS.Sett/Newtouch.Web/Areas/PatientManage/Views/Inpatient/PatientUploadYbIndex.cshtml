@{
    Layout = "~/Views/Shared/_Index.cshtml";

    //医保所属地，区分系统将执行何处医保逻辑
    var medicalInsurance = SysConfigReader.String("Inpatient_MedicalInsurance");
    var opr = Newtouch.Common.Operator.OperatorProvider.GetCurrent();
}
<style>
    .title {
        width:60px;
    }
</style>

<ul id="myTab" class="nav nav-tabs">
    <li class="active">
        <a href="#ybbrsjsc" data-toggle="tab">医保病人数据上传</a>
    </li>
    <li>
        <a href="#zfbrsjsc" data-toggle="tab">自费病人数据上传</a>
    </li>
</ul>

<div id="myTabContent" class="tab-content">
    @*医保病人数据上传  *@
    <div class="tab-pane fade in active" id="ybbrsjsc">
        <div class="panel panel-default">
            <div class="panel-heading navb-bg">
                筛选条件
            </div>
            <table class="form">
                <tr>
                    <th class="formTitle">在院状态：</th>
                    <td class="formValue">
                        <select id="zybz" name="zybz" class="form-control">
                            <option value="">==请选择==</option>
                            <option value="0,1,2,7">在院</option>
                            <option value="3" selected="selected">已出院</option>
                            <option value="9">已作废</option>
                        </select>
                    </td>
                    <th class="formTitle">关键字：</th>
                    <td class="formValue">
                        <input id="txt_keyword" type="text" class="form-control form-an" placeholder="姓名/病历号/住院号">
                    </td>
                    <th class="formTitle">入院日期：</th>
                    <td class="formValue" colspan="2">
                        <input id="ryrqkssj" type="text" class="form-control input-wdatepicker" style="width:42%; float:left;" value="@DateTime.Now.AddMonths(-1).ToString("yyyy-MM-dd")" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd' })" />
                        <span style="margin-left:1%;float:left">—</span>
                        <input id="ryrqjssj" type="text" class="form-control input-wdatepicker" style="width:43%; float:left;margin-left:1%;" value="@DateTime.Now.ToString("yyyy-MM-dd")" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd' })" />
                    </td>

                </tr>
                <tr>
                    <th class="formTitle" style="width:70px;padding-right:12px;">入院科室：</th>
                    <td class="formValue">
                        <input type="text" id="ksmc" name="ksmc" class="form-control form-an" />
                    </td>
                    <th class="formTitle" style="width:70px;padding-right:12px;">入院病区：</th>
                    <td class="formValue">
                        <input type="text" id="bqmc" name="bqmc" class="form-control form-an" />
                    </td>
                    <th class="formTitle">上传类型：</th>
                    <td class="formValue" style="width:70%;" colspan="2">
                        <select class="form-control" id="ybscsel">
                            <option value="4101">【4101】结算清单上传</option>
                            <option value="4401">【4401】病案首页上传</option>
                            <option value="4402">【4402】住院医嘱上传</option>
                            <option value="4501">【4501】临床检查上传</option>
                            <option value="4502">【4502】临床检验报告上传</option>
                            <option value="4503">【4503】细菌培养报告上传</option>
                            <option value="4504">【4504】药敏记录报告上传</option>
                            <option value="4505">【4505】非结构化报告上传</option>
                            <option value="4506">【4506】电子病历上传</option>
                            <option value="4601">【4601】输血信息上传</option>
                            <option value="4602">【4601】护理体征记录上传</option>
                            <option value="4701">【4701】电子病历上传</option>
                        </select>
                    </td>

                    <td class="formTitle" colspan="2">
                        <input type="button" id="btn_ybsc" class="btn btn-primary" style="width:36%;" value="上传" />
                        <input type="button" id="btn_search" class="btn btn-primary" style="width:36%;margin-left: 10%;" value="查询" />
                    </td>
                </tr>
            </table>
        </div>
        <div class="gridPanel">
            <table id="gridList"></table>
            <div id="gridPager"></div>
        </div>
    </div>
    @*自费病人数据上传  *@
<div class="tab-pane fade" id="zfbrsjsc">
    <div class="panel panel-default">
        <div class="panel-heading navb-bg">
            筛选条件
        </div>
        <table class="form">
            <tr>
                <td class="formValue" style="width:100px;">
                    <select class="form-control" id="zflxscsel">
                        <option value="mz">门诊</option>
                        <option value="zy">住院</option>
                    </select>
                </td>
                <th class="formTitle">关键字：</th>
                <td class="formValue" style="width:12%;">
                    <input id="txt_zfkeyword" type="text" class="form-control form-an" placeholder="姓名/病历号/住院号">
                </td>
                <th class="formTitle">结算日期：</th>
                <td class="formValue" colspan="1">
                    <input id="zfjskssj" type="text" class="form-control input-wdatepicker" style="width:42%; float:left;" value="@DateTime.Now.AddMonths(-1).ToString("yyyy-MM-dd")" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd' })" />
                    <span style="margin-left:1%;float:left">—</span>
                    <input id="zfjsjssj" type="text" class="form-control input-wdatepicker" style="width:42%; float:left;margin-left:1%;" value="@DateTime.Now.ToString("yyyy-MM-dd")" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd' })" />
                </td>
                <th class="formTitle">上传类型：</th>
                <td class="formValue" colspan="1">
                    <select class="form-control" style="width:90%;" id="zfscsel">
                    </select>
                </td>
                <td class="formTitle" style="width:20%;" colspan="1">
                    <input type="button" id="btn_zfsc" class="btn btn-primary" style="width:60%;" value="上传/删除/提交" />
                    <input type="button" id="btn_zfsearch" class="btn btn-primary" style="width:30%;margin-left: 10%;" value="查询" />
                </td>
            </tr>
            <tr>
            </tr>
        </table>
    </div>
    <div class="mzzfgridPanel" style="width:100%;" >
        <table id="mzzfgridList"></table>
        <div id="mzzfgridPager"></div>
    </div>
    <div class="zyzfgridPanel">
        <table id="zyzfgridList"></table>
        <div id="zyzfgridPager"></div>
    </div>
</div>
</div>


<script>
    $(function () {
        initControl();
        gridList();
    })
    function gridList() {
        if ($("#ksmc").val() == "") {
            $("#ksmc").attr("data-label", "");
        }
        if ($("#bqmc").val() == "") {
            $("#bqmc").attr("data-label", "");
        }
        var $gridList = $("#gridList");
        $gridList.dataGrid({
            url: "/PatientManage/Inpatient/GridInPatientGridJson",
            height: $(window).height() - 188,
            postData: {
                keyword: $("#txt_keyword").val(), zybz: $("#zybz").val(), ryrqkssj: $("#ryrqkssj").val(),
                yrqjssj: $("#ryrqjssj").val(), ksmc: $("#ksmc").attr("data-label"), bqmc: $("#bqmc").attr("data-label")
            },
            colModel: [
                { label: '住院号', name: 'zyh', width: 50, align: 'left', key: true },
                {
                    label: '在院标志', name: 'zybz', width: 60, align: 'left', formatter: function (cellvalue) {
                        return $.enum.getDescByValue("EnumZYBZ", cellvalue);
                    }
                },
                { label: '病历号', name: 'blh', hidden: true },
                { label: '是否上传', name: 'issc', width: 60, align: 'left' },
                { label: '姓名', name: 'xm', width: 60, align: 'left' },
                { label: '性别', name: 'sexValue', width: 40, align: 'left' },
                {
                    label: '年龄', name: 'nlshow', width: 40, align: 'left', formatter: function (cellvalue, a, b) {
                        return getAgeFromBirthTime({ begin: b.csny }).text;
                    }
                },
                { label: '病区', name: 'bqmc', width: 80, align: 'left' },
                { label: '民族', name: 'mzmc', width: 50, align: 'left', hidden: true },
                { label: '电话', name: 'lxrdh', width: 80, align: 'left', hidden: true },
                { label: '出生年月', name: 'csny', width: 80, align: 'left', hidden: true },
                { label: '证件号', name: 'zjh', width: 120, align: 'left' },
                { label: 'brxz', name: 'brxz', width: 80, align: 'left', hidden: true },
                { label: 'CardType', name: 'CardType', width: 80, align: 'left', hidden: true },
                { label: 'cbdbm', name: 'cbdbm', width: 80, align: 'left', hidden: true },
                { label: '费用性质', name: 'brxzmc', width: 80, align: 'left' },
                {
                    label: '入院状态', name: 'rybq', width: 50, align: 'left', hidden: true, formatter: function (cellvalue) {
                        return $.enum.getDescByValue("EnumWzjb", cellvalue);
                    }
                },
                { label: '第一诊断', name: 'zzdmc', width: 100, align: 'left' },
                { label: '入院日期', name: 'ryrq', width: 80, align: 'left' },
                { label: '出院日期', name: 'cyrq', width: 80, align: 'left' },
                { label: '已产生费用', name: 'zyfy', width: 80, align: 'left' },
                { label: 'setl_id', name: 'setl_id', hidden: true },
                { label: 'psn_no', name: 'psn_no', hidden: true },
                { label: 'mdtrt_id', name: 'mdtrt_id', hidden: true },
                { label: '预交费', name: 'yjj', width: 50, align: 'left' },
                { label: 'jzh', name: 'jzh', width: 80, align: 'left', hidden: true },

                {
                    label: '最后更新时间', name: 'UpdateTime', width: 80, align: 'left',
                    formatter: "date", formatoptions: { srcformat: 'Y-m-d H:i:s', newformat: 'Y-m-d H:i:s' }
                },
            ],
            pager: "#gridPager",
            sortname: 'ryrq,UpdateTime',
            viewrecords: true
        });
        $("#btn_search").click(function () {
            if ($("#ksmc").val() == "") {
                $("#ksmc").attr("data-label", "");
            }
            if ($("#bqmc").val() == "") {
                $("#bqmc").attr("data-label", "");
            }
            $gridList.jqGrid('setGridParam', {
                postData: {
                    keyword: $("#txt_keyword").val(), zybz: $("#zybz").val(), ryrqkssj: $("#ryrqkssj").val(),
                    yrqjssj: $("#ryrqjssj").val(), ksmc: $("#ksmc").attr("data-label"), bqmc: $("#bqmc").attr("data-label")
                },
            }).trigger('reloadGrid');
        });
    }

    //回车事件
    $('#txt_keyword').keydownEnterEvent(function () {
        $('#btn_search').trigger('click');
    })

    $('#zybz').change(function () {
        $('#btn_search').trigger('click');
    });

    function initControl() {

    }
</script>
<script type="text/javascript">
    var medicalInsurance = '@medicalInsurance';
    var zyh = '';
    var kh = "";
    var jzh = '';
    $('#btn_ybsc').click(function () {
        uploadData($('#ybscsel').val());
    });

    function uploadData(upobj) {
        var seleRow = check();
        if (!!!seleRow) {
            return;
        }
        var isBrxzOk = seleRow.brxz == '0';
        if (isBrxzOk) {
            $.modalAlert("错误：选择的是非医保", "warning");
            return;
        }
        var zyh = seleRow.zyh;
        var cbdbm = seleRow.cbdbm;
        var dbscobj = { mdtrt_id: seleRow.mdtrt_id, psn_no: seleRow.psn_no, hisId: zyh, operatorId: '@(opr.rygh)', operatorName: '@(opr.UserName)', insuplc_admdvs: cbdbm };
        var upUrl;
        switch (upobj) {
            case '4101':
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostMedicalSettlement_4101_V2";
                break;
            case '4401':
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostMedicalRcord_4401";
                //upUrl = "http://127.0.0.1:33333/api/YiBao/PostUploadMedicalRcord";
                break;
            case '4402':
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostDoctorAdvice_4402";
                break;
            case '4501':
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostClinicalExamination_4501";
                break;
            case '4502':
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostClinicalExamination_4502";
                break;
            case '4503':
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostPathologyCheck_4503";
                break;
            case '4504':
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostPathologyCheck_4504";
                break;
            case '4505':
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostPathologyCheck_4505";
                break;
            case "4506":
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostPathologyCheck_4506";
                break;
            case "4601":
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostPathologyCheck_4601";
                break;
            case "4602":
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostPathologyCheck_4602";
                break;
            case '4701':
                upUrl = "http://127.0.0.1:33333/api/YiBao/PostMedicalRecords_4701";
                break;
        }
        $.loading("数据上传中，请稍等");
        $.ajax({
            type: "POST",
            url: upUrl,
            data: dbscobj,
            dataType: "json",
            async: false,
            success: function (data) {
                var tfReturn = eval('(' + data + ')');
                if (tfReturn) {
                    if (tfReturn.infcode == "0") {
                        $.loading(false);
                        $.modalAlert("住院号为:" + zyh + "，上传成功", 'warning');
                    }
                    else {
                        $.loading(false);
                        $.modalAlert("住院号-"+zyh+"上传失败：" + tfReturn.err_msg, 'error');
                    }
                }
            }, error: function (request, error, ex) {
                $.loading(false);
                $.modalAlert("医保服务【" + upobj + "】不可访问：[" + ex + "]", 'error');
            }
        });
    }

    function check() {
        var seleRow = $("#gridList").jqGridRowValue();
        var zyh = seleRow.zyh;
        if (!!!zyh) {
            $.modalAlert("尚未选择一条记录", "warning");
            return;
        }
        //if (seleRow.zybz == '已出院') {
        //    $.modalAlert("患者已出院", "error");
        //    return;
        //}
        else if (seleRow.zybz == '作废记录') {
            $.modalAlert("已作废记录", "error");
            return;
        }
        if (!medicalInsurance) {
            $.modalAlert("缺少配置医保就医地", "error");
            return;
        }
        return seleRow;
    }

    ///科室
    $("#ksmc").newtouchBatchFloatingSelector({
        height: 200,
        width: 300,
        clickautotrigger: true,
        filter: function (keyword) {

            //遍历数据源，用keyword来筛选出结果
            var resultObjArr = new Array();
            $.each(top.window.clients.sysDepartList, function (idx, val) {
                if ((val.py && val.py.toLowerCase().indexOf(keyword) >= 0)
                        || (val.Name && val.Name.indexOf(keyword) >= 0)
                    || keyword.trim() == "") {
                    resultObjArr.push(val);
                }
            });
            return resultObjArr;

        },
        caption: "科室",
        colModel: [
            { label: '编号', name: 'Code', widthratio: 30 },
            { label: '名称', name: 'Name', widthratio: 50 },
            { label: '拼音', name: 'py', hidden: true }
        ],
        itemdbclickhandler: function ($thistr) {
            $("#ksmc").attr("data-label", $thistr.find("td:eq(0)").html());
            $("#ksmc").val($thistr.find('td:eq(1)').html());
            return;
        },
    });
    ///病区
    $("#bqmc").newtouchBatchFloatingSelector({
        height: 200,
        width: 300,
        clickautotrigger: true,
        filter: function (keyword) {
            //遍历数据源，用keyword来筛选出结果
            var resultObjArr = new Array();
            var ks = $("#ksmc").attr("data-label");
            var bqlist = top.window.clients.sysWardDeptRelation.filter((item) => item.ks == ks);
            $.each(bqlist, function (idx, val) {
                if ((val.bqpy && val.bqpy.toLowerCase().indexOf(keyword.toLowerCase()) >= 0)
                    || (val.bqmc && val.bqmc.indexOf(keyword) >= 0)
                    || keyword.trim() == "") {
                    resultObjArr.push(val);
                }
            });
            return resultObjArr;

        },
        caption: "病区",
        colModel: [
            {
                label: '编号', name: 'bq', widthratio: 25
            },
            {
                label: '名称', name: 'bqmc', widthratio: 50
            }
        ],
        itemdbclickhandler: function ($thistr) {
            $("#bqmc").attr("data-label", $thistr.find("td:eq(0)").html());
            $("#bqmc").val($thistr.find('td:eq(1)').html());
            return;
        },
    });

    /*自费病人上传的逻辑*/

    // 门诊和住院对应的选项
    var mzOptions = [
        { value: '4205', text: '【4205】自费病人门诊就医信息上传' },
        { value: '4206', text: '【4206】自费病人门诊就医信息删除' },
        { value: '4203', text: '【4203】自费病人就诊以及费用明细上传完成' },
        { value: '4201', text: '【4201】自费病人费用明细信息上传(废弃)' }
    ];

    var zyOptions = [
        //{ value: '4201A', text: '【4201A】自费病人住院费用明细信息上传' },
        { value: '4202', text: '【4202】自费病人住院就诊和诊断信息上传' },
        { value: '4204', text: '【4204】自费病人住院费用明细删除' },
        { value: '4203', text: '【4203】自费病人就诊以及费用明细上传完成' },
        { value: '4201', text: '【4201】自费病人费用明细信息上传(废弃)' }
    ];
    // 根据选中的值动态更新选项
    function updateZfscselOptions(options) {
        var zfscsel = document.getElementById('zfscsel');
        zfscsel.innerHTML = ''; // 清空现有选项

        options.forEach(function (option) {
            var opt = document.createElement('option');
            opt.value = option.value;
            opt.text = option.text;
            zfscsel.appendChild(opt);
        });
    }

    // 监听门诊/住院选择框的变化
    document.getElementById('zflxscsel').addEventListener('change', function () {
        var selectedValue = this.value;
        if (selectedValue === 'mz') {
            updateZfscselOptions(mzOptions);
        } else if (selectedValue === 'zy') {
            updateZfscselOptions(zyOptions);
        }
        gridJSListData()
    });

    $(function () {
        // 初始默认选择门诊
        updateZfscselOptions(mzOptions);
        gridJSListData()
    })


    //获取列表的查询条件
    function getSearchPostData() {
        var zflx = $("#zflxscsel").val();
        var xm = $("#txtxm").val();
        var createTimestart = $("#zfjskssj").val() + ' 00:00:00';
        var createTimeEnd = $("#zfjsjssj").val() + ' 23:59:59';
        if (zflx === 'mz') {
            return { xm: xm, CreateTimestart: createTimestart, CreateTimeEnd: createTimeEnd };
        } else if (zflx === 'zy') {
            return { keyword: xm, jsksrq: createTimestart, jsjsrq: createTimeEnd };
        }

    };

    //查询结算信息列表
    function gridJSListData() {
        var zflx = $("#zflxscsel").val();
        var gridSort = 'CreateTime asc';
        if (zflx === 'mz') {
            $('.zyzfgridPanel').hide();  // 隐藏 zyzfgridPanel
            $('.mzzfgridPanel').show();
            var $gridJsList = $("#mzzfgridList");
            $gridJsList.dataGrid({
                postData: getSearchPostData(),
                height: $(window).height() - 188,
                url: "/OutpatientManage/OutpatientChargeQuery/SelectZFRegChargeQuery",
                colModel: [
                    { label: 'jsnm', name: 'jsnm', hidden: true, align: 'left' },
                    {
                        label: '结算类型', name: 'jslx', width: 120, align: "left",
                        formatter: function (val) {
                            return $.enum.getDescByValue("EnumJslx", val);
                        }
                    },
                    { label: '病例号', name: 'blh', width: 100, align: 'left' },
                    { label: '姓名', name: 'xm', width: 120, align: 'left' },
                    { label: '门诊号', name: 'mzh', width: 140, align: 'left' },
                    { label: '费用性质', name: 'brxzmc', width: 120, align: 'left' },
                    { label: '发票号', name: 'fph', width: 100, align: 'left' },
                    {
                        label: '结算金额', name: 'jszje', width: 100, align: 'left', formatter: function (cellvalue) {
                            return cellvalue ? cellvalue.toFixed(2) : "0.00";
                        }
                    },
                    {
                        label: '支付金额', name: 'jsxjzf', width: 100, align: 'left', formatter: function (cellvalue) {
                            return cellvalue ? cellvalue.toFixed(2) : "0.00";
                        }
                    },
                    { label: '上传', name: 'sfyb', width: 80, align: 'left' },
                    {
                        label: '费用日期', name: 'sfrq', width: 120, align: 'left', formatter: "date", formatoptions: { srcformat: 'Y-m-d', newformat: 'Y-m-d' }
                    },
                    { label: '收费人员', name: 'CreatorName', width: 120, align: 'left' },
                    { label: '医生', name: 'jzys', width: 120, align: 'left' },
                    {
                        label: '操作时间', name: 'CreateTime', width: 160, align: 'left', formatter: "date", formatoptions: { srcformat: 'Y-m-d H:i:s', newformat: 'Y-m-d H:i:s' }
                    }
                ],
                pager: "#mzzfgridPager",
                sortname: gridSort,
                viewrecords: true,
            });
        } else if (zflx === 'zy') {
            $('.mzzfgridPanel').hide();  // 隐藏 mzzfgridPanel
            $('.zyzfgridPanel').show();
            var $gridJsList = $("#zyzfgridList");
            $gridJsList.dataGrid({
               url: "/HospitalizationManage/Settlement/GetPaginationZFSettlementList",
                postData: getSearchPostData(),
                height: $(window).height() - 188,
                colModel: [
                    { label: 'jsnm', name: 'jsnm', key: true, hidden: true },
                    { label: '住院号', name: 'zyh', width: 40, align: 'left' },
                    { label: '姓名', name: 'xm', width: 60, align: 'left' },
                    { label: '性别', name: 'xb', width: 30, align: 'left' },
                    { label: '身份证', name: 'zjh', width: 115, align: 'left' },
                    { label: '出生日期', name: 'csrq', width: 60, align: 'left' },
                    { label: '新生儿', name: 'isxsr', width: 40, align: 'left' },
                    { label: '民族', name: 'mz', width: 25, align: 'left' },
                    { label: '主治医生', name: 'zzys', width: 50, align: 'left' },
                    { label: '归转', name: 'gz', width: 25, align: 'left' },
                    { label: '离院方式', name: 'lyfs', width: 50, align: 'left' },
                    { label: '出院诊断', name: 'cyzd', width: 50, align: 'left' },
                    { label: '家庭地址', name: 'jtdz', width: 50, align: 'left' },
                    { label: '费用性质', name: 'brxzmc', width: 50, align: 'left' },
                    { label: '入院日期', name: 'ryrq', width: 60, align: 'left', formatter: "date", formatoptions: { srcformat: 'Y-m-d', newformat: 'Y-m-d' } },
                    { label: '出院日期', name: 'cyrq', width: 60, align: 'left', formatter: "date", formatoptions: { srcformat: 'Y-m-d', newformat: 'Y-m-d' } },
                    { label: '发票号', name: 'fph', width: 60, align: 'left' },
                    { label: '上传', name: 'sfyb', width: 80, align: 'left' },
                    { label: '总金额', name: 'zje', width: 80, align: 'left', formatter: 'number', formatoptions: { thousandsSeparator: ",", decimalPlaces: 2 } },
                    { label: '现金支付', name: 'xjzf', width: 80, align: 'left', formatter: 'number', formatoptions: { thousandsSeparator: ",", decimalPlaces: 2 } },
                    { label: '结算人员', name: 'CreatorCode', width: 60, align: 'left' },
                    { label: '医保结算号', name: 'zxlsh', width: 60, align: 'left' },
                    { label: '结算时间', name: 'CreateTime', width: 100, align: 'left', formatter: "date", formatoptions: { srcformat: 'Y-m-d H:i:s', newformat: 'Y-m-d H:i:s' }    }
                ],
                pager: "#zyzfgridPager",
                sortname: gridSort,
                viewrecords: true,
            });
        }

    }

    function sxGridJSListData() {
        var zflx = $("#zflxscsel").val();;
        if (zflx === 'mz') {
            var $gridJsList = $("#mzzfgridList");
            $gridJsList.jqGrid('setGridParam', {
                postData: getSearchPostData(),
                page: 1,
            }).trigger('reloadGrid');
        } else if (zflx === 'zy') {
            var $gridJsList = $("#zyzfgridList");
            $gridJsList.jqGrid('setGridParam', {
                postData: getSearchPostData(),
                page: 1,
            }).trigger('reloadGrid');
        }
    }

    //查询
    $("#btn_zfsearch").click(function () {
        sxGridJSListData()
    });
    //
    $('#btn_zfsc').click(function () {
        zfUploadData($('#zfscsel').val());
    });

    function zfUploadData(upobj) {
        var zflx = $("#zflxscsel").val();
        var hisId = '';
       
        var seleRow;
        if (zflx === 'mz') {
            seleRow = $("#mzzfgridList").jqGridRowValue();
            hisId = seleRow.mzh;
        } else if (zflx === 'zy') {
            seleRow = $("#zyzfgridList").jqGridRowValue();
            hisId = seleRow.zyh;
        }
        if (!!!seleRow) {
            $.modalAlert("侵犯选择一条数据", "warning");
            return;
        }
        var isBrxzOk = seleRow.brxzmc !== '自费';
        if (isBrxzOk) {
            $.modalAlert("错误：选择的是非自费", "warning");
            return;
        }
        var dbscobj = { jsnm: seleRow.jsnm, hisId: hisId, operatorId: '@(opr.rygh)', operatorName: '@(opr.UserName)', cplt_flag: "1" };
         var upUrl;
         switch (upobj) {
            case '4201':
                 upUrl = "http://127.0.0.1:33333/api/YiBao/PostSelfPayPatientFee_4201";
                 $.modalAlert("该接口暂时无用", "warning");
                 return
                break;
            case '4201A':
                 upUrl = "http://127.0.0.1:33333/api/YiBao/PostSelfPayPatientFee_4201A";
                 if (seleRow.sfyb == '已上传') {
                     $.modalAlert("该数据已经上传，无需重复上传", "warning");
                     return;
                 }
                break;
            case '4202':
                 upUrl = "http://127.0.0.1:33333/api/YiBao/PostSelfPayPatientFee_4202";
                 if (seleRow.sfyb == '已上传') {
                     $.modalAlert("该数据已经上传，无需重复上传", "warning");
                     return;
                 }
                break;
            case '4203':
                 upUrl = "http://127.0.0.1:33333/api/YiBao/PostSelfPayPatientFee_4203";
                 if (seleRow.sfyb !== '已上传') {
                     $.modalAlert("该数据暂未上传，请上传后再提交", "warning");
                     return;
                 }
                break;
            case '4204':
                 upUrl = "http://127.0.0.1:33333/api/YiBao/PostSelfPayPatientFee_4204";
                 if (seleRow.sfyb !== '已上传') {
                     $.modalAlert("该数据暂未上传无法删除", "warning");
                     return;
                 }
                break;
            case '4205':
                 upUrl = "http://127.0.0.1:33333/api/YiBao/PostSelfPayPatientFee_4205";
                 if (seleRow.sfyb == '已上传') {
                     $.modalAlert("该数据已经上传，无需重复上传", "warning");
                     return;
                 }
                break;
            case '4206':
                 upUrl = "http://127.0.0.1:33333/api/YiBao/PostSelfPayPatientFee_4206";
                 if (seleRow.sfyb !== '已上传') {
                     $.modalAlert("该数据暂未上传无法删除", "warning");
                     return;
                 }
                break;
        }
        $.loading("数据上传中，请稍等");
        $.ajax({
            type: "POST",
            url: upUrl,
            data: dbscobj,
            dataType: "json",
            async: false,
            success: function (data) {
                var tfReturn = eval('(' + data + ')');
                if (tfReturn) {
                    if (tfReturn.infcode == "0") {
                        if (upobj == "4202") {
                            if (seleRow.sfyb == '已上传') {
                                $.modalAlert("该数据已经上传，无需重复上传", "warning");
                                return;
                            }
                            PostSelfPayPatientFee_4201A(dbscobj)
                        } else {
                            $.loading(false);
                            $.modalAlert("住院号/门诊号为:" + hisId + "，上传成功", 'warning');
                        }
                       
                    }
                    else {
                        $.loading(false);
                        $.modalAlert("住院号/门诊号-" + hisId +"上传失败：" + tfReturn.err_msg, 'error');
                    }
                }
            }, error: function (request, error, ex) {
                $.loading(false);
                $.modalAlert("医保服务【" + upobj + "】不可访问：[" + ex + "]", 'error');
            }
        });
        sxGridJSListData()
    }

    function PostSelfPayPatientFee_4201A(dbscobj) {
        $.ajax({
            type: "POST",
            url: 'http://127.0.0.1:33333/api/YiBao/PostSelfPayPatientFee_4201A',
            data: dbscobj,
            dataType: "json",
            async: false,
            success: function (data) {
                var tfReturn = eval('(' + data + ')');
                if (tfReturn) {
                    if (tfReturn.infcode == "0") {
                        $.loading(false);
                        $.modalAlert("住院号/门诊号为:" + dbscobj.hisId + "，上传成功", 'warning');
                    }
                    else {
                        $.loading(false);
                        $.modalAlert("住院号/门诊号-" + dbscobj.hisId + "上传失败：" + tfReturn.err_msg, 'error');
                    }
                }
            }, error: function (request, error, ex) {
                $.loading(false);
                $.modalAlert("医保服务【4201A】不可访问：[" + ex + "]", 'error');
            }
        });
    }
</script>
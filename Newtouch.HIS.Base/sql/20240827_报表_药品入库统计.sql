USE [NewtouchHIS_Base]
GO

/****** Object:  StoredProcedure [dbo].[PRT_PDS_药品入库统计]    Script Date: 2024-08-27 13:40:36 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[PRT_PDS_药品入库统计]
    @hospitalCode varchar(50),
	@yfbmCode varchar(50),
	@kssj DATETIME ,
	@jssj DATETIME
AS
SELECT yp.ypmc AS 药品名称,ypsx.ypgg AS 药品规格,(CAST(crkmx.Sl AS VARCHAR(10)) +crkmx.rkdw) AS 数量,crk.Pdh,crkmx.pc 药品批次,yp.ycmc AS 生产厂家,
       crkmx.Pfj AS 成本单价,(crkmx.Pfj*crkmx.Sl) AS 成本总价,crkmx.Lsj AS 零售单价,(crkmx.Lsj*crkmx.Sl)  AS 零售总价
        ,crk.Rkbm,crk.Rksj
FROM NewtouchHIS_PDS..xt_yp_crkdj AS crk INNER  JOIN NewtouchHIS_PDS..xt_yp_crkmx AS crkmx ON crk.crkId=crkmx.crkId
                                         INNER JOIN NewtouchHIS_Base..xt_yp AS yp ON crkmx.Ypdm=yp.ypCode
                                         INNER JOIN NewtouchHIS_Base..xt_ypsx AS ypsx ON yp.ypId=ypsx.ypId
WHERE crk.djlx=1 AND crk.OrganizeId=@hospitalCode
  AND crk.zt='1'
  AND crk.Rkbm=@yfbmCode

    GO

delete from NewtouchHIS_Base.dbo.Sys_Report where ReportCode = '1299' and ReportName = '药品入库统计';
delete from NewtouchHIS_Base.dbo.Sys_ReportTemplate where ReportCode = '1299' and ReportName = '药品入库统计';

INSERT INTO NewtouchHIS_Base.dbo.Sys_Report ( HospitalCode, SystemCode, SystemName, ReportCode, ReportName, PinYin, ReportDes, ReportType, CreateTime, CreatorCode, LastModifyTime, LastModifierCode, px, zt, StatusTemplateID, ParentId, DirectoryFlag) VALUES ( N'6d5752a7-234a-403e-aa1c-df8b45d3469f', N'PDS', N'药房药库', N'1311', N'药品入库统计', N'药品入库统计', N'药品入库统计', 1, N'2024-08-27 13:44:39.803', N'xztest', null, null, null, 1, null, 3, 0);

INSERT INTO NewtouchHIS_Base.dbo.Sys_ReportTemplate ( HospitalCode, SystemCode, ReportCode, ReportNameDes, Content, ReportStatus, CreateTime, CreatorCode, LastModifyTime, LastModifierCode, zt) VALUES ( N'6d5752a7-234a-403e-aa1c-df8b45d3469f', N'PDS', N'1311', N'药品入库统计', N'﻿<?xml version="1.0" encoding="utf-8"?><Report xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition"><dd:Name xmlns:dd="http://schemas.datadynamics.com/reporting/2005/02/reportdefinition">1221_6d5752a7-234a-403e-aa1c-df8b45d3469f_&amp;#x836F;&amp;#x54C1;&amp;#x5165;&amp;#x5E93;&amp;#x7EDF;&amp;#x8BA1;.rdlx</dd:Name><Body><Height>5.25cm</Height><ReportItems><Textbox Name="文本框1"><Top>1cm</Top><Left>6.5cm</Left><Width>2.5cm</Width><Height>0.75cm</Height><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop></Style><CanGrow>true</CanGrow><Value>药品入库统计</Value></Textbox><Textbox Name="文本框11"><Top>1.75cm</Top><Left>0.499cm</Left><Width>2.5cm</Width><Height>0.75cm</Height><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop></Style><ZIndex>2</ZIndex><CanGrow>true</CanGrow><Value>药房部门:</Value></Textbox><Table Name="表格1"><Top>2.5cm</Top><Left>0.5cm</Left><Width>14.5cm</Width><Height>1.75cm</Height><Style><FontFamily>微软雅黑</FontFamily></Style><ZIndex>3</ZIndex><DataSetName>数据集1</DataSetName><DetailDataElementOutput>Auto</DetailDataElementOutput><Header><RepeatOnNewPage>true</RepeatOnNewPage><TableRows><TableRow><Height>1cm</Height><TableCells><TableCell><ReportItems><Textbox Name="文本框2"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Left</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><Value>药品名称</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框15"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Left</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><Value>规格</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框16"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Left</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><Value>数量</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框17"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Left</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><Value>批号</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框18"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Left</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><Value>生产厂家</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框19"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Left</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><Value>成本单价</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框12"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Left</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><Value>成本总价</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框3"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Left</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><Value>零售单价</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框4"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Left</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><Value>零售总价</Value></Textbox></ReportItems></TableCell></TableCells></TableRow></TableRows></Header><Details><TableRows><TableRow><Height>0.75cm</Height><TableCells><TableCell><ReportItems><Textbox Name="文本框5"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Center</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><DataElementName>药品名称</DataElementName><Value>=Fields!药品名称.Value</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框20"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Center</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><DataElementName>药品规格</DataElementName><Value>=Fields!药品规格.Value</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框21"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Center</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><DataElementName>数量</DataElementName><Value>=Fields!数量.Value</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框22"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Center</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><DataElementName>药品批次</DataElementName><Value>=Fields!药品批次.Value</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框23"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Center</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><DataElementName>生产厂家</DataElementName><Value>=Fields!生产厂家.Value</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框24"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Center</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><DataElementName>成本单价</DataElementName><Value>=Fields!成本单价.Value</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框13"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Center</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><DataElementName>成本总价</DataElementName><Value>=Fields!成本总价.Value</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框6"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Center</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><DataElementName>零售单价</DataElementName><Value>=Fields!零售单价.Value</Value></Textbox></ReportItems></TableCell><TableCell><ReportItems><Textbox Name="文本框7"><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop><TextAlign>Center</TextAlign><VerticalAlign>Middle</VerticalAlign><BorderColor><Default>DimGray</Default></BorderColor><BorderStyle><Default>Solid</Default></BorderStyle></Style><CanGrow>true</CanGrow><DataElementName>零售总价</DataElementName><Value>=Fields!零售总价.Value</Value></Textbox></ReportItems></TableCell></TableCells></TableRow></TableRows></Details><TableColumns><TableColumn><Width>1.611cm</Width></TableColumn><TableColumn><Width>1.611cm</Width></TableColumn><TableColumn><Width>1.611cm</Width></TableColumn><TableColumn><Width>1.611cm</Width></TableColumn><TableColumn><Width>1.611cm</Width></TableColumn><TableColumn><Width>1.611cm</Width></TableColumn><TableColumn><Width>1.611cm</Width></TableColumn><TableColumn><Width>1.611cm</Width></TableColumn><TableColumn><Width>1.612cm</Width></TableColumn></TableColumns></Table><Textbox Name="文本框30"><Top>4.5cm</Top><Left>9.499cm</Left><Width>2cm</Width><Height>0.75cm</Height><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop></Style><ZIndex>4</ZIndex><CanGrow>true</CanGrow><Value>打印时间：</Value></Textbox><Textbox Name="TextBox1"><Top>4.5cm</Top><Left>10.665cm</Left><Width>4.334cm</Width><Height>0.75cm</Height><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop></Style><ZIndex>5</ZIndex><CanGrow>true</CanGrow><Value>=First(Fields!打印时间.Value, "数据集2")</Value></Textbox><Textbox Name="TextBox2"><Top>1.75cm</Top><Left>2.498cm</Left><Width>2.5cm</Width><Height>0.75cm</Height><Style><FontFamily>微软雅黑</FontFamily><PaddingBottom>2pt</PaddingBottom><PaddingLeft>2pt</PaddingLeft><PaddingRight>2pt</PaddingRight><PaddingTop>2pt</PaddingTop></Style><ZIndex>6</ZIndex><CanGrow>true</CanGrow><Value>=First(Fields!药房部门名称.Value, "数据集2")</Value></Textbox></ReportItems></Body><BottomMargin>2.5cm</BottomMargin><LeftMargin>2.5cm</LeftMargin><PageHeight>29.7cm</PageHeight><PageWidth>21cm</PageWidth><RightMargin>2.5cm</RightMargin><TopMargin>2.5cm</TopMargin><Width>15cm</Width><ReportParameters><ReportParameter Name="hospitalCode"><DataType>String</DataType><Prompt>@hospitalCode</Prompt><UsedInQuery>True</UsedInQuery></ReportParameter><ReportParameter Name="yfbmCode"><DataType>String</DataType><Prompt>@yfbmCode</Prompt><UsedInQuery>True</UsedInQuery></ReportParameter><ReportParameter Name="kssj"><DataType>DateTime</DataType><Prompt>@kssj</Prompt><dd:DateOnly xmlns:dd="http://schemas.datadynamics.com/reporting/2005/02/reportdefinition">false</dd:DateOnly><UsedInQuery>True</UsedInQuery></ReportParameter><ReportParameter Name="jssj"><DataType>DateTime</DataType><Prompt>@jssj</Prompt><dd:DateOnly xmlns:dd="http://schemas.datadynamics.com/reporting/2005/02/reportdefinition">false</dd:DateOnly><UsedInQuery>True</UsedInQuery></ReportParameter></ReportParameters><DataSources><DataSource Name="数据源1"><ConnectionProperties><ConnectString>Data Source=192.168.9.190,1433;Initial Catalog=NewtouchHIS_Base;User ID=sa;Password=Abcd1234;MultipleActiveResultSets=true;</ConnectString><DataProvider>SQL</DataProvider></ConnectionProperties></DataSource></DataSources><DataSets><DataSet Name="数据集1"><Fields><Field Name="药品名称"><DataField>药品名称</DataField></Field><Field Name="药品规格"><DataField>药品规格</DataField></Field><Field Name="数量"><DataField>数量</DataField></Field><Field Name="Pdh"><DataField>Pdh</DataField></Field><Field Name="药品批次"><DataField>药品批次</DataField></Field><Field Name="生产厂家"><DataField>生产厂家</DataField></Field><Field Name="成本单价"><DataField>成本单价</DataField></Field><Field Name="成本总价"><DataField>成本总价</DataField></Field><Field Name="零售单价"><DataField>零售单价</DataField></Field><Field Name="零售总价"><DataField>零售总价</DataField></Field><Field Name="Rkbm"><DataField>Rkbm</DataField></Field><Field Name="Rksj"><DataField>Rksj</DataField></Field></Fields><Query><CommandText>PRT_PDS_药品入库统计</CommandText><DataSourceName>数据源1</DataSourceName><CommandType>StoredProcedure</CommandType><QueryParameters><QueryParameter Name="@hospitalCode"><Value>=Parameters!hospitalCode.Value</Value></QueryParameter><QueryParameter Name="@yfbmCode"><Value>=Parameters!yfbmCode.Value</Value></QueryParameter><QueryParameter Name="@kssj"><Value>=Parameters!kssj.Value</Value></QueryParameter><QueryParameter Name="@jssj"><Value>=Parameters!jssj.Value</Value></QueryParameter></QueryParameters></Query></DataSet><DataSet Name="数据集2"><Fields><Field Name="药房部门名称"><DataField>药房部门名称</DataField></Field><Field Name="打印时间"><DataField>打印时间</DataField></Field></Fields><Query><CommandText>select yfbmmc as ''药房部门名称'',GETDATE() AS  ''打印时间''  FROM [NewtouchHIS_Base]..V_S_xt_yfbm where yfbmCode = @yfbmCode </CommandText><DataSourceName>数据源1</DataSourceName><QueryParameters><QueryParameter Name="@yfbmCode"><Value>=Parameters!yfbmCode.Value</Value></QueryParameter></QueryParameters></Query></DataSet></DataSets><CustomProperties><CustomProperty><Name>DisplayType</Name><Value>Page</Value></CustomProperty><CustomProperty><Name>SizeType</Name><Value>Default</Value></CustomProperty><CustomProperty><Name>PaperOrientation</Name><Value>Portrait</Value></CustomProperty><CustomProperty><Name>数据集1_Data_Set_Fields</Name><Value>{"药品名称":{"aggregate":"Count","dataType":"String"},"药品规格":{"aggregate":"Count","dataType":"String"},"数量":{"aggregate":"Count","dataType":"String"},"Pdh":{"aggregate":"Count","dataType":"String"},"药品批次":{"aggregate":"Count","dataType":"String"},"生产厂家":{"aggregate":"Count","dataType":"String"},"成本单价":{"aggregate":"Sum","dataType":"Float"},"成本总价":{"aggregate":"Sum","dataType":"Float"},"零售单价":{"aggregate":"Sum","dataType":"Float"},"零售总价":{"aggregate":"Sum","dataType":"Float"},"Rkbm":{"aggregate":"Count","dataType":"String"},"Rksj":{"aggregate":"Count","dataType":"DateTime"}}</Value></CustomProperty><CustomProperty><Name>数据集2_Data_Set_Fields</Name><Value>{"药房部门名称":{"aggregate":"Count","dataType":"String"},"打印时间":{"aggregate":"Count","dataType":"DateTime"}}</Value></CustomProperty></CustomProperties></Report>', 1, N'2024-08-27 13:44:54.783', N'xztest', N'2024-08-27 14:38:10.177', N'admin', 1);

INSERT INTO NewtouchHIS_PDS.dbo.Sys_Module (Id, ParentId, Name, EnName, Code, Icon, UrlAddress, Target, px, Description, CreateTime, CreatorCode, LastModifyTime, LastModifierCode, zt, OrganizeId, AppId) VALUES (N'ebca7d90-3fd5-474e-9af7-544a447f918c', N'837ac5a2-7a9d-46b3-a249-f81ab47a74d1', N'药品入库统计', null, null, null, N'/ReportManage/YpckQuery/YprkQuery', N'iframe', 28, null, N'2024-08-27 14:57:52.817', N'xztest', N'2024-08-27 15:42:58.257', N'xztest', N'1', N'6d5752a7-234a-403e-aa1c-df8b45d3469f', null);
